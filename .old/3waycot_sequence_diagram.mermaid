sequenceDiagram
    participant User
    participant Main as 3WayCOT Main
    participant CoT as Chain-of-Thought Generator
    participant TCB as Triadic Context Builder (Triadic fca)
    participant CLB as Concept Lattice Builder (Triadic fca)
    participant MC as Membership Calculator
    participant TWD as Three-Way Decision Maker
    participant UR as Uncertainty Resolver
    participant Agg as Aggregator
    participant KB as Knowledge Base

    User->>Main: Query Q, Context C
    
    Main->>CoT: ReasoningGenerator(Q, C)
    CoT-->>Main: Return reasoning steps S
    
    Main->>TCB: TriadicContextBuilder(S, KB)
    TCB->>KB: Lookup knowledge
    KB-->>TCB: Return knowledge
    TCB-->>Main: Return triadic context K
    
    Main->>CLB: ConceptLatticeBuilder(K, τ)
    CLB-->>Main: Return concept lattice L
    
    loop For each reasoning step Si in S
        Main->>MC: MembershipCalculator(Si, L)
        MC-->>Main: Return membership intervals
        
        Main->>TWD: ThreeWayDecision(membership intervals, α, β)
        TWD-->>Main: Return decision di (accept/reject/abstain)
        
        alt if decision is "abstain"
            Main->>Main: Add Si to uncertain steps U
        end
    end
    
    alt if uncertain steps exist (U ≠ ∅)
        Main->>UR: UncertaintyResolver(U, S, K, KB)
        UR->>KB: Additional knowledge lookup
        KB-->>UR: Return knowledge
        UR-->>Main: Return updated steps S'
        
        alt if steps were updated (S' ≠ S)
            Main->>Main: Recursive call to 3WayCOT
        end
    end
    
    Main->>Agg: Aggregator(S, decisions, membership intervals)
    Agg-->>Main: Return answer y with uncertainty bounds
    
    Main-->>User: Return answer with uncertainty quantification